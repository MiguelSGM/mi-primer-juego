<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DEEP</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg: #050505;
            --surface: #111111;
            --accent: #007AFF;
            --text: #ffffff;
            --text-dim: #888888;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background: var(--bg); color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            overflow: hidden;
        }

        /* --- PANTALLAS --- */
        .screen {
            position: fixed; inset: 0; display: none;
            flex-direction: column; padding: 25px; z-index: 10;
        }
        .screen.active { display: flex; }

        /* --- BIENVENIDA Y REGISTRO --- */
        #screen-welcome { justify-content: center; align-items: center; text-align: center; }
        .hero-title { font-size: 5rem; letter-spacing: 1rem; margin: 0; font-weight: 900; }
        .hero-lema { font-size: 1rem; color: var(--text-dim); margin: 15px 0 40px; text-transform: uppercase; letter-spacing: 3px; }
        
        .form-group { display: none; flex-direction: column; gap: 15px; width: 100%; max-width: 300px; }
        input, select {
            background: var(--surface); border: 1px solid #333; color: white;
            padding: 15px; border-radius: 12px; font-size: 1rem; outline: none;
        }
        .btn-main {
            background: white; color: black; border: none; padding: 18px 45px;
            font-size: 1.1rem; font-weight: 700; border-radius: 50px; cursor: pointer;
        }

        /* --- APP INTERFACE --- */
        .header { display: flex; justify-content: flex-start; padding-top: 10px; }
        .logo-med { font-size: 1.8rem; font-weight: 800; cursor: pointer; letter-spacing: 3px; }

        .content-scroll {
            flex: 1; overflow-y: auto; display: flex; flex-direction: column;
            margin-top: 20px; padding-bottom: 100px;
        }

        /* HOME MSG GIGANTE */
        #home-welcome-msg { 
            font-size: 2.1rem; font-weight: 700; text-align: justify; 
            line-height: 1.1; margin-top: auto;
        }
        .lema-cursiva { font-style: italic; font-size: 3rem; color: var(--accent); display: block; margin-bottom: 20px; text-align: left; }

        /* SESIONES */
        .session-card {
            background: var(--surface); padding: 25px; border-radius: 20px;
            margin-bottom: 15px; border: 1px solid #222;
        }
        .card-name { font-size: 1.8rem; font-weight: 800; margin-bottom: 10px; color: var(--accent); }
        .card-meta { display: flex; justify-content: space-between; color: var(--text-dim); font-size: 1.1rem; font-family: monospace; }

        /* CRONOMETRO */
        .timer-view { align-items: center; justify-content: center; height: 100%; text-align: center; }
        .timer-top { width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        .clock { font-size: 6rem; font-weight: 200; font-family: monospace; margin: 40px 0; }
        .btn-finish { background: #ff3b30; color: white; border: none; padding: 10px 20px; border-radius: 10px; font-weight: bold; }

        /* ESTADISTICAS */
        .stats-container { display: flex; justify-content: space-around; width: 100%; margin: auto 0; }
        .stat-item { text-align: center; }
        .stat-big { font-size: 5rem; font-weight: 900; color: var(--accent); display: block; }
        .stat-label { color: var(--text-dim); text-transform: uppercase; font-size: 0.8rem; letter-spacing: 2px; }

        /* MODAL */
        #modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px;
        }
        .modal-box { background: var(--surface); padding: 30px; border-radius: 25px; width: 100%; text-align: center; }

        /* NAVEGACION (Distancia 2cm aprox) */
        .nav {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: rgba(20, 20, 20, 0.8); backdrop-filter: blur(20px);
            padding: 15px 40px; border-radius: 40px; display: flex; gap: 70px;
            border: 1px solid #333; z-index: 100;
        }
        .nav-btn { color: var(--text-dim); cursor: pointer; transition: 0.3s; }
        .nav-btn.active { color: white; transform: scale(1.2); }
    </style>
</head>
<body>

    <section id="screen-welcome" class="screen active">
        <h1 class="hero-title">DEEP</h1>
        <p class="hero-lema">Focus beyond the surface</p>
        <button id="btn-start-init" class="btn-main" onclick="showRegistration()">Empecemos</button>
        
        <div id="form-registration" class="form-group">
            <input type="text" id="username" placeholder="Usuario">
            <input type="text" id="fav-subject" placeholder="Asignatura favorita">
            <button class="btn-main" onclick="completeRegistration()">Entrar</button>
        </div>
    </section>

    <section id="screen-app" class="screen">
        <div class="header">
            <div class="logo-med" onclick="showTab('home')">DEEP</div>
        </div>

        <div class="content-scroll" id="main-content">
            <div id="tab-home" class="tab-view">
                <div id="home-intro">
                    <span class="lema-cursiva">Focus beyond the surface</span>
                    <div id="home-welcome-msg">
                        Bienvenido a DEEP, la mejor web para impulsar tus estudios. Est√°s en tu men√∫, aqu√≠ ver√°s las sesiones de estudio que a√±adas de ahora en adelante. 
                        <br><br>
                        Si clicas a "a√±adir", podr√°s meter todas las sesiones de estudio que quieras. 
                        <br><br>
                        En "estad√≠sticas", podr√°s ver todo lo que has estudiado este mes, a√±o o semana, adem√°s de gr√°ficos y m√°s detalles. ¬°Disfruta de tu experiencia en DEEP! üöÄ
                    </div>
                </div>
                <div id="sessions-list" style="display: flex; flex-direction: column-reverse;"></div>
            </div>

            <div id="tab-add" class="tab-view" style="display: none;">
                <div class="timer-view">
                    <div class="timer-top">
                        <div style="display:flex; flex-direction:column; align-items:flex-start; gap:10px;">
                            <select id="subject-selector" onchange="toggleOther(this)">
                                <option value="Matem√°ticas‚ûï">Matem√°ticas‚ûï</option>
                                <option value="Ingl√©süá∫üá∏">Ingl√©süá∫üá∏</option>
                                <option value="Lengua Castellana y Literatura üá™üá∏">Lengua üá™üá∏</option>
                                <option value="Otra">Otra</option>
                            </select>
                            <input type="text" id="other-input" placeholder="¬øCu√°l?" style="display:none; padding:10px;">
                        </div>
                        <button class="btn-finish" onclick="finishSession()">Terminar</button>
                    </div>
                    <div class="clock" id="clock-display">00:00:00</div>
                    <button class="clk-btn" onclick="toggleTimer()" id="timer-btn">
                        <i data-lucide="pause-circle" size="80"></i>
                    </button>
                </div>
            </div>

            <div id="tab-stats" class="tab-view" style="display: none;">
                <div class="stats-container">
                    <div class="stat-item">
                        <span class="stat-big" id="stat-sessions">0</span>
                        <span class="stat-label">Sesiones</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-big" id="stat-hours">0</span>
                        <span class="stat-label">Horas</span>
                    </div>
                </div>
                <div style="margin-top: 50px; text-align: center;">
                    <span class="stat-label">Racha Actual</span>
                    <span class="stat-big" id="stat-streak" style="color: #FF9500;">0</span>
                    <p id="streak-info" style="color:var(--text-dim)">D√≠as seguidos</p>
                </div>
                <div style="margin-top: 50px; text-align: center;">
                    <span class="stat-label">Asignatura Top</span>
                    <span class="stat-big" id="stat-top-subject" style="font-size: 2.5rem; margin-top: 10px;">-</span>
                </div>
            </div>
        </div>

        <nav class="nav">
            <div class="nav-btn active" onclick="showTab('home')"><i data-lucide="home"></i></div>
            <div class="nav-btn" onclick="showTab('add')"><i data-lucide="plus-circle"></i></div>
            <div class="nav-btn" onclick="showTab('stats')"><i data-lucide="bar-chart-3"></i></div>
        </nav>
    </section>

    <div id="modal">
        <div class="modal-box">
            <h2 style="margin:0">Sesi√≥n Finalizada</h2>
            <div class="clock" id="modal-time" style="font-size: 3rem; margin: 20px 0;">00:00:00</div>
            <input type="text" id="session-name-input" placeholder="Nombre del tema (ej: √Ålgebra)" style="width:100%; margin-bottom:20px;">
            <button class="btn-main" style="width:100%" onclick="saveSession()">Subir Sesi√≥n</button>
        </div>
    </div>

    <script>
        lucide.createIcons();

        let timer = null;
        let seconds = 0;
        let isPaused = false;
        let confettiActive = false;

        let db = JSON.parse(localStorage.getItem('deep_db')) || {
            user: '', fav: '', sessions: [], streak: 0, lastDate: null, subStats: {}
        };

        window.onload = () => {
            if(db.user) {
                document.getElementById('screen-welcome').classList.remove('active');
                document.getElementById('screen-app').classList.add('active');
                renderSessions();
                updateStatsUI();
            }
        }

        function showRegistration() {
            document.getElementById('btn-start-init').style.display = 'none';
            document.getElementById('form-registration').style.display = 'flex';
        }

        function completeRegistration() {
            const user = document.getElementById('username').value;
            const fav = document.getElementById('fav-subject').value;
            if(!user || !fav) return alert("Rellena los campos");
            db.user = user; db.fav = fav;
            saveDB();
            location.reload();
        }

        function showTab(tab) {
            document.querySelectorAll('.tab-view').forEach(t => t.style.display = 'none');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-' + tab).style.display = 'block';
            event.currentTarget.classList.add('active');
            
            if(tab === 'add' && !timer && seconds === 0) startTimer();
        }

        function toggleOther(sel) {
            document.getElementById('other-input').style.display = sel.value === 'Otra' ? 'block' : 'none';
        }

        function startTimer() {
            isPaused = false;
            updateTimerIcon();
            timer = setInterval(() => {
                seconds++;
                updateTimerUI();
                if(seconds === 1800 && !confettiActive) {
                    confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                    confettiActive = true;
                }
            }, 1000);
        }

        function toggleTimer() {
            if(isPaused) startTimer();
            else { clearInterval(timer); timer = null; isPaused = true; updateTimerIcon(); }
        }

        function updateTimerIcon() {
            const btn = document.getElementById('timer-btn');
            btn.innerHTML = isPaused ? `<i data-lucide="play-circle" size="80"></i>` : `<i data-lucide="pause-circle" size="80"></i>`;
            lucide.createIcons();
        }

        function updateTimerUI() {
            const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
            const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            document.getElementById('clock-display').innerText = `${h}:${m}:${s}`;
        }

        function finishSession() {
            clearInterval(timer); timer = null;
            document.getElementById('modal-time').innerText = document.getElementById('clock-display').innerText;
            document.getElementById('modal').style.display = 'flex';
        }

        function saveSession() {
            let subj = document.getElementById('subject-selector').value;
            if(subj === 'Otra') subj = document.getElementById('other-input').value || 'Otra';
            const name = document.getElementById('session-name-input').value || "Sin nombre";
            const date = new Date().toLocaleDateString();

            const session = { name, subj, time: document.getElementById('clock-display').innerText, date, rawSecs: seconds };
            
            db.sessions.push(session);
            db.subStats[subj] = (db.subStats[subj] || 0) + seconds;

            // Racha
            if(seconds >= 1800) {
                const today = new Date().toDateString();
                if(db.lastDate !== today) {
                    db.streak++;
                    db.lastDate = today;
                }
            }

            saveDB();
            location.reload();
        }

        function renderSessions() {
            if(db.sessions.length > 0) {
                document.getElementById('home-intro').style.display = 'none';
                const container = document.getElementById('sessions-list');
                db.sessions.forEach(s => {
                    const el = document.createElement('div');
                    el.className = 'session-card';
                    el.innerHTML = `
                        <div class="card-name">${s.name}</div>
                        <div class="card-meta">
                            <span>${s.subj}</span>
                            <span>${s.date} ‚Äî ${s.time}</span>
                        </div>
                    `;
                    container.appendChild(el);
                });
            }
        }

        function updateStatsUI() {
            document.getElementById('stat-sessions').innerText = db.sessions.length;
            const totalSecs = db.sessions.reduce((acc, s) => acc + s.rawSecs, 0);
            document.getElementById('stat-hours').innerText = (totalSecs / 3600).toFixed(1);
            document.getElementById('stat-streak').innerText = db.streak;
            
            let topSub = "-";
            let max = 0;
            for(let s in db.subStats) {
                if(db.subStats[s] > max) { max = db.subStats[s]; topSub = s; }
            }
            document.getElementById('stat-top-subject').innerText = topSub;
        }

        function saveDB() { localStorage.setItem('deep_db', JSON.stringify(db)); }
    </script>
</body>
</html>
