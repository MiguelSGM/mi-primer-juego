<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Snake Donostia Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; background: #1a1a1a; display: flex; justify-content: center; align-items: center; height: 100vh; }
    </style>
</head>
<body>
<script>
    const config = {
        type: Phaser.AUTO,
        width: 640,
        height: 480,
        backgroundColor: '#2d2d2d',
        parent: 'phaser-example',
        scene: { preload: preload, create: create, update: update }
    };

    let snake;
    let food;
    let cursors;
    let moveTime = 0;
    let direction = { x: 16, y: 0 }; // Empieza moviéndose a la derecha
    let nextDirection = { x: 16, y: 0 };

    const game = new Phaser.Game(config);

    function preload() {
        // Creamos rectángulos simples directamente con código para no cargar imágenes externas
        let graphics = this.make.graphics({ x: 0, y: 0, add: false });
        graphics.fillStyle(0xffffff, 1);
        graphics.fillRect(0, 0, 16, 16);
        graphics.generateTexture('block', 16, 16);

        graphics.clear();
        graphics.fillStyle(0xff0000, 1);
        graphics.fillRect(0, 0, 16, 16);
        graphics.generateTexture('food', 16, 16);
    }

    function create() {
        // Creamos la serpiente como un grupo de imágenes
        snake = [];
        for (let i = 0; i < 3; i++) {
            snake.push(this.add.image(160 - (i * 16), 160, 'block'));
        }

        food = this.add.image(320, 240, 'food');

        cursors = this.input.keyboard.createCursorKeys();
    }

    function update(time) {
        // Control de dirección (evita que la serpiente se gire sobre sí misma)
        if (cursors.left.isDown && direction.x === 0) nextDirection = { x: -16, y: 0 };
        else if (cursors.right.isDown && direction.x === 0) nextDirection = { x: 16, y: 0 };
        else if (cursors.up.isDown && direction.y === 0) nextDirection = { x: 0, y: -16 };
        else if (cursors.down.isDown && direction.y === 0) nextDirection = { x: 0, y: 16 };

        // Actualizamos la posición cada 100 milisegundos (velocidad del juego)
        if (time >= moveTime) {
            moveTime = time + 100;
            moveSnake();
        }
    }

    function moveSnake() {
        direction = nextDirection;

        // Calculamos la nueva posición de la cabeza
        let x = snake[0].x + direction.x;
        let y = snake[0].y + direction.y;

        // Comprobar colisión con comida
        if (x === food.x && y === food.y) {
            let newPart = game.scene.scenes[0].add.image(food.x, food.y, 'block');
            snake.unshift(newPart); // Añadir al principio
            repositionFood();
        } else {
            // Mover el cuerpo: la última parte pasa a ser la primera
            let part = snake.pop();
            part.x = x;
            part.y = y;
            snake.unshift(part);
        }

        // Comprobar derrota (Paredes)
        if (x < 0 || x >= 640 || y < 0 || y >= 480) {
            alert("¡Game Over!");
            location.reload();
        }

        // Comprobar derrota (Cuerpo)
        for (let i = 1; i < snake.length; i++) {
            if (x === snake[i].x && y === snake[i].y) {
                alert("¡Te has chocado contigo mismo!");
                location.reload();
            }
        }
    }

    function repositionFood() {
        let x = Math.floor(Math.random() * (640 / 16)) * 16;
        let y = Math.floor(Math.random() * (480 / 16)) * 16;
        food.setPosition(x, y);
    }
</script>
</body>
</html>
