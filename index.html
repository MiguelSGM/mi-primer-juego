<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Neon - Bordes Arcade</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        * { box-sizing: border-box; }
        body { 
            margin: 0; background: #000; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; height: 100vh; width: 100vw;
            color: #33ff00; font-family: 'Courier New', Courier, monospace; overflow: hidden;
        }
        #game-wrapper { position: relative; width: 640px; }
        #ui-panel {
            width: 100%; display: flex; justify-content: space-between; align-items: center;
            padding: 10px; background: #111; border: 3px solid #33ff00; border-bottom: none;
            border-radius: 15px 15px 0 0; box-shadow: 0 0 15px #33ff0055;
        }
        #start-menu {
            position: absolute; top: 51px; left: 0; width: 640px; height: 480px;
            background: rgba(0, 0, 0, 0.95); display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 100;
            border: 3px solid #33ff00; border-radius: 0 0 15px 15px;
        }
        h1 { font-size: 50px; text-shadow: 0 0 20px #33ff00; margin-bottom: 30px; }
        .play-btn {
            background: #33ff00; color: #000; border: none; padding: 15px 40px;
            font-size: 24px; font-family: 'Courier New'; cursor: pointer; font-weight: bold;
        }
        .play-btn:hover { background: #fff; box-shadow: 0 0 25px #33ff00; }
        button.diff-btn {
            background: #222; border: 1px solid #33ff00; color: #33ff00;
            padding: 5px 10px; cursor: pointer; font-size: 11px;
        }
        button.active { background: #33ff00; color: #000; }

        /* BORDE DE NEÓN PARA LA PANTALLA */
        #phaser-app { 
            width: 640px; height: 480px; 
            border: 3px solid #33ff00; 
            border-radius: 0 0 15px 15px;
            box-shadow: 0 0 20px #33ff0044;
        }
    </style>
</head>
<body>

    <div id="game-wrapper">
        <div id="ui-panel">
            <div style="display: flex; gap: 8px;">
                <button class="diff-btn" id="btn-200" onclick="setDifficulty(200)">FÁCIL</button>
                <button class="diff-btn" id="btn-120" onclick="setDifficulty(120)">MEDIO</button>
                <button class="diff-btn" id="btn-70" onclick="setDifficulty(70)">DIFÍCIL</button>
            </div>
            <div id="score-display">0 | 0</div>
        </div>

        <div id="start-menu">
            <h1>SNAKE NEON</h1>
            <button class="play-btn" onclick="startGame()">JUGAR</button>
        </div>

        <div id="phaser-app"></div>
    </div>

<script>
    let gameSpeed = parseInt(localStorage.getItem('snakeSpeed')) || 120;
    let gameStarted = false;
    let audioCtx;
    let appleCount = 0, highScore = localStorage.getItem('snakeHighScore') || 0;
    let snake = [], food, cursors, moveTime = 0, direction = { x: 16, y: 0 }, nextDirection = { x: 16, y: 0 };

    const config = {
        type: Phaser.CANVAS,
        width: 640, height: 480, parent: 'phaser-app',
        backgroundColor: '#050505',
        scene: { preload: preload, create: create, update: update }
    };

    const game = new Phaser.Game(config);

    function preload() {
        let graphics = this.make.graphics({ x: 0, y: 0, add: false });
        // Cuerpo de serpiente con estilo bloque
        graphics.lineStyle(2, 0x33ff00).fillStyle(0x004400).fillRoundedRect(1, 1, 14, 14, 4).strokeRoundedRect(1, 1, 14, 14, 4);
        graphics.generateTexture('block', 16, 16);
        // Manzana circular
        graphics.clear().fillStyle(0xff0000).fillCircle(8, 8, 7).generateTexture('food', 16, 16);
    }

    function create() {
        document.getElementById('score-display').innerText = `${appleCount} | ${highScore}`;
        highlightButton();

        // DIBUJAR REJILLA SUTIL Y LÍMITE INTERIOR
        let grid = this.add.graphics();
        grid.lineStyle(1, 0x111111, 0.5);
        for (let i = 0; i < 640; i += 16) { grid.moveTo(i, 0); grid.lineTo(i, 480); }
        for (let j = 0; j < 480; j += 16) { grid.moveTo(0, j); grid.lineTo(640, j); }
        grid.strokePath();

        for (let i = 0; i < 3; i++) snake.push(this.add.image(160 - (i * 16), 160, 'block'));
        food = this.add.image(320, 240, 'food');
        cursors = this.input.keyboard.createCursorKeys();
    }

    function update(time) {
        if (!gameStarted) return;
        if (cursors.left.isDown && direction.x === 0) nextDirection = { x: -16, y: 0 };
        else if (cursors.right.isDown && direction.x === 0) nextDirection = { x: 16, y: 0 };
        else if (cursors.up.isDown && direction.y === 0) nextDirection = { x: 0, y: -16 };
        else if (cursors.down.isDown && direction.y === 0) nextDirection = { x: 0, y: 16 };
        
        if (time >= moveTime) {
            moveTime = time + gameSpeed; 
            moveSnake();
        }
    }

    function moveSnake() {
        direction = nextDirection;
        let x = snake[0].x + direction.x, y = snake[0].y + direction.y;
        
        if (x === food.x && y === food.y) {
            playNote(600, 0.05, 'sine', 0.1);
            appleCount++;
            if (appleCount > highScore) { highScore = appleCount; localStorage.setItem('snakeHighScore', highScore); }
            document.getElementById('score-display').innerText = `${appleCount} | ${highScore}`;
            let newPart = game.scene.scenes[0].add.image(food.x, food.y, 'block');
            snake.unshift(newPart);
            repositionFood();
        } else {
            let part = snake.pop(); part.x = x; part.y = y; snake.unshift(part);
        }
        
        // COMPROBACIÓN DE COLISIÓN CON LOS BORDES
        if (x < 0 || x >= 640 || y < 0 || y >= 480) gameOver();
        for (let i = 1; i < snake.length; i++) if (x === snake[i].x && y === snake[i].y) gameOver();
    }

    function repositionFood() {
        food.setPosition(Math.floor(Math.random() * 40) * 16, Math.floor(Math.random() * 30) * 16);
    }

    function playNote(freq, dur, type, vol) {
        if (!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + dur);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + dur);
    }

    window.startGame = function() {
        gameStarted = true;
        document.getElementById('start-menu').style.display = 'none';
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const melody = [261.63, 0, 329.63, 392.00, 261.63, 0, 349.23, 329.63];
            let step = 0;
            setInterval(() => {
                if (gameStarted && melody[step] > 0) playNote(melody[step], 0.15, 'triangle', 0.02);
                step = (step + 1) % melody.length;
            }, 250);
        }
    }

    function highlightButton() {
        document.querySelectorAll('.diff-btn').forEach(b => {
            const speed = parseInt(b.getAttribute('onclick').match(/\d+/)[0]);
            if(speed === gameSpeed) b.classList.add('active');
            else b.classList.remove('active');
        });
    }

    window.setDifficulty = function(speed) {
        localStorage.setItem('snakeSpeed', speed);
        location.reload();
    }

    function gameOver() {
        gameStarted = false;
        alert("GAME OVER\nManzanas: " + appleCount);
        location.reload();
    }
</script>
</body>
</html>
